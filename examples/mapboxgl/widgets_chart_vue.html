<!--********************************************************************
* Copyright© 2000 - 2019 SuperMap Software Co.Ltd. All rights reserved.
*********************************************************************-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title data-i18n='resources.title_widgetsChart_Vue'></title>
  <script type="text/javascript" include="vue" src="../js/include-web.js"></script>
  <script include="echarts-vue,iclient9-mapboxgl-widgets-vue" src="../../dist/mapboxgl/include-mapboxgl.js"></script>
  <style>
    #main {
      margin: 0 auto;
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body style=" margin: 0;overflow: hidden;background: #fff;width: 100%;height:100%;position: absolute;top: 0;">
  <div id="main">
  <sm-web-map server-url='http://support.supermap.com.cn:8092/'  map-id="1649097980"></sm-web-map>
  <sm-chart 
    icon-class=""  
    :style="chartStyle" 
    :options="echartOption"
  ></sm-chart>
  <sm-chart 
    icon-class=""  
    :style="chartStyle1" 
    :options="echartOption1"
  ></sm-chart>
  <sm-chart 
    icon-class=""  
    :style="chartStyle2" 
    :options="echartOption2"
  ></sm-chart>
  </div>


  <script>
    new Vue({
      el: '#main',
      data() {
        return {
          chartStyle: {
            width: "400px",
            height: "300px",
            position: "absolute",
            bottom: "10px",
            right: "10px"
          },
          chartStyle1: {
            width: "400px",
            height: "300px",
            position: "absolute",
            bottom: "10px",
            right: "420px"
          },
          chartStyle2: {
            width: "400px",
            height: "300px",
            position: "absolute",
            bottom: "10px",
            right: "830px"
          },
          echartOption:{},
          echartOption1:{},
          echartOption2:{}
          
        };
      },
      mounted(){
          // datasets和dataOptions，echartOptions都是sm-chart组件的props
         let datasets = {
            type: "iPortal", //iServer iPortal
            url: "http://support.supermap.com.cn:8092/web/datas/1920557079",
            queryInfo: {
              maxFeatures: 20
            }
          },
          // echarts中涉及到超图数据series和坐标轴的字段的配置
          dataOptions = [
            {
              seriesType: "bar", //图表类型
              isStastic: true, //是否统计, 默认不统计
              isStack: true, //是否堆叠, 默认不堆叠
              xField: "机场", //x坐标轴数据字段
              yField: "2016起降架次（架次）" //统计的数据，legned默认名字
            },
            {
              seriesType: "bar",
              isStastic: true,
              isStack: true,
              xField: "机场",
              yField: "2017起降架次（架次）",
            }
          ],
          dataOptions1 = [
            {
              seriesType: "line", //图表类型
              isStastic: true, //是否统计, 默认不统计
              isStack: true, //是否堆叠, 默认不堆叠
              xField: "机场", //x坐标轴数据字段
              yField: "2016旅客吞吐量（人次）" //统计的数据，legned默认名字
            },
            {
              seriesType: "line",
              isStastic: true,
              isStack: true,
              xField: "机场",
              yField: "2017旅客吞吐量（人次）"
            }
          ],
          dataOptions2 = [
            {
              seriesType: "scatter", //图表类型
              isStastic: true, //是否统计, 默认不统计
              isStack: false, //是否堆叠, 默认不堆叠
              xField: "机场", //x坐标轴数据字段
              yField: "同比增速%" //统计的数据，legned默认名字
            }
          ],
          // 和echarts一样的配置
          echartOptions = {
            legend: {data: ['2016起降架次（架次）', '2017起降架次（架次）']}, //与legendName || yField数据一致
            tooltip: {formatter: "{b0}: {c0}"},
            grid:{ 
              top: 30,
              bottom: 60,
              left: 60,
              right: 30
            }
          },
          echartOptions1 = {
            legend: {data: ['2016旅客吞吐量（人次）', '2017旅客吞吐量（人次）']}, //与legendName || yField数据一致
            tooltip: {formatter: "{b0}: {c0}"},
            grid:{ 
              top: 30,
              bottom: 60,
              left: 60,
              right: 30
            }
          },
          echartOptions2 = {
            legend: {data: ['同比增速%']},//与legendName || yField数据一致
            tooltip: {formatter: "{b0}: {c0}"},
          };
          let EchartsDataService = SuperMap.Widgets.utils.EchartsDataService;
          let echartsDataService = new EchartsDataService();
          echartsDataService.getDataOption(datasets, dataOptions).then(data => {
            this.echartOption = Object.assign(data, echartOptions);
            this.echartOption1  = Object.assign(echartsDataService.formatChartData(dataOptions1), echartOptions1);
            this.echartOption2  = Object.assign(echartsDataService.formatChartData(dataOptions2), echartOptions2);
        });
      }
    })
  </script>
</body>

</html>