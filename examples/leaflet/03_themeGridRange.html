<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>栅格分段专题图</title>
    <link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="http://cdn.bootcss.com/leaflet/1.0.3/leaflet.css">
    <script type="text/javascript" src="http://cdn.bootcss.com/leaflet/1.0.3/leaflet.js"></script>
    <script type="text/javascript" src="../../dist/iclient9-leaflet.js"></script>
    <script type="text/javascript">
        var map, themeService, themeLayer, themeGridRange, themeParameters,
                url = "http://support.supermap.com.cn:8090/iserver/services/map-jingjin/rest/maps/京津地区人口分布图_专题图";
        function init() {
            map = L.map('map', {
                crs: L.CRS.EPSG4326,
                center: [40, 118],
                maxZoom: 18,
                zoom: 6
            });
            L.supermap.tiledMapLayer(url, {noWrap: true}).addTo(map);
            themeService = L.supermap.themeService(url);
            var themeGridRangeItem1 = new ThemeGridRangeItem({
                        start: -4,
                        end: 120,
                        color: new ServerColor(198, 244, 240)
                    }),

                    themeGridRangeItem2 = new ThemeGridRangeItem({
                        start: 120,
                        end: 240,
                        color: new ServerColor(176, 244, 188)
                    }),
                    themeGridRangeItem3 = new ThemeGridRangeItem({
                        start: 240,
                        end: 360,
                        color: new ServerColor(218, 251, 178)
                    }),
                    themeGridRangeItem4 = new ThemeGridRangeItem({
                        start: 360,
                        end: 480,
                        color: new ServerColor(220, 236, 145)
                    }),
                    themeGridRangeItem5 = new ThemeGridRangeItem({
                        start: 480,
                        end: 600,
                        color: new ServerColor(96, 198, 66)
                    }),
                    themeGridRangeItem6 = new ThemeGridRangeItem({
                        start: 600,
                        end: 720,
                        color: new ServerColor(20, 142, 53)
                    }),
                    themeGridRangeItem7 = new ThemeGridRangeItem({
                        start: 720,
                        end: 840,
                        color: new ServerColor(85, 144, 55)
                    }),

                    themeGridRangeItem8 = new ThemeGridRangeItem({
                        start: 840,
                        end: 960,
                        color: new ServerColor(171, 168, 38)
                    }),
                    themeGridRangeItem9 = new ThemeGridRangeItem({
                        start: 960,
                        end: 1100,
                        color: new ServerColor(235, 165, 9)
                    }),
                    themeGridRangeItem10 = new ThemeGridRangeItem({
                        start: 1100,
                        end: 1220,
                        color: new ServerColor(203, 89, 2)
                    }),
                    themeGridRangeItem11 = new ThemeGridRangeItem({
                        start: 1220,
                        end: 1340,
                        color: new ServerColor(157, 25, 1)
                    }),
                    themeGridRangeItem12 = new ThemeGridRangeItem({
                        start: 1340,
                        end: 1460,
                        color: new ServerColor(118, 15, 3)
                    }),
                    themeGridRangeItem13 = new ThemeGridRangeItem({
                        start: 1460,
                        end: 1600,
                        color: new ServerColor(112, 32, 7)
                    }),

                    themeGridRangeItem14 = new ThemeGridRangeItem({
                        start: 1600,
                        end: 1800,
                        color: new ServerColor(106, 45, 12)
                    }),
                    themeGridRangeItem15 = new ThemeGridRangeItem({
                        start: 1800,
                        end: 2000,
                        color: new ServerColor(129, 80, 50)
                    }),
                    themeGridRangeItem16 = new ThemeGridRangeItem({
                        start: 2000,
                        end: 2167,
                        color: new ServerColor(160, 154, 146)
                    });
            themeGridRange = new ThemeGridRange({
                reverseColor: false,
                rangeMode: RangeMode.EQUALINTERVAL,
                items: [
                    themeGridRangeItem1, themeGridRangeItem2,
                    themeGridRangeItem3, themeGridRangeItem4,
                    themeGridRangeItem5, themeGridRangeItem6,
                    themeGridRangeItem7, themeGridRangeItem8,
                    themeGridRangeItem9, themeGridRangeItem10,
                    themeGridRangeItem11, themeGridRangeItem12,
                    themeGridRangeItem13, themeGridRangeItem14,
                    themeGridRangeItem15, themeGridRangeItem16
                ]
            });
            themeParameters = new ThemeParameters({
                datasetNames: ["JingjinTerrain"],
                dataSourceNames: ["Jingjin"],
                joinItems: null,
                themes: [themeGridRange]
            });
        }
        function createTheme() {
            themeService.getThemeStatus(themeParameters)
                    .on('complete', function (serviceResult) {
                        var result = serviceResult.result;
                        if (result && result.newResourceID) {
                            themeLayer = L.supermap.tiledMapLayer(url, {
                                noWrap: true,
                                cacheEnabled: false,
                                transparent: true,
                                layersID: result.newResourceID
                            }).addTo(map);
                        }
                    }).on('failed', function (error) {
                alert(error.errorMsg);
            });
        }

        function clearLayer() {
            if (themeLayer) {
                map.removeLayer(themeLayer);
            }
        }

    </script>
</head>
<body onload="init()" style=" margin: 0;overflow: hidden;background: #fff;width: 100%;height:600px;">
<div id="toolbar" style="height:44px; padding-top: 6px; text-align: right ">
    <input type="button" class="btn btn-default" value="创建专题图" onclick="createTheme()"/>
    <input type="button" class="btn btn-default" value="清除结果" onclick="clearLayer()"/>
</div>
<div id="map" style="margin:0 auto;width: 100%;height: 100%;border: 1px solid #dddddd"></div>
</body>
</html>