<html>
<head>
<title></title>
<script type="text/javascript" src="../libs/SuperMap.Include.js"></script>
<script type="text/javascript" src="./js/jquery.js"></script>
<script type="text/javascript">
var map,layer,tempLayerID = null,drawPoint,drawLine ,markerLayer,vectorLayer,
        pointStyle = {
            fillColor:"red",
            strokeOpacity:1,
            strokeColor:"yellow",
            pointRadius:6
        },
        lineStyle={
            strokeColor: "#304DBE",
            strokeWidth: 5,
            pointerEvents: "visiblePainted",
            fillColor: "#304DBE",
            fillOpacity: 0.8,
            pointRadius:6
        };
var url="http://localhost:8090/iserver/services/map-world/rest/maps/World";

//实例化 DragPan 控件
var dragPan = new SuperMap.Control.DragPan();
function onload() {
    //创建地图控件
    map = new SuperMap.Map("map", {controls: [
        new SuperMap.Control.ScaleLine(),
        new SuperMap.Control.Zoom(),
        new SuperMap.Control.Navigation({
            dragPanOptions: {
                enableKinetic: true
            }
        })]
    });
    //添加点击事件
   map.events.on({"mouseup": getCurrentCoord});
    //将 dragPan 控件添加到 map
    //创建 TiledDynamicRESTLayer
    layer = new SuperMap.Layer.TiledDynamicRESTLayer("World", url, {transparent: true, cacheEnabled: false, redirect: true, layersID: tempLayerID}, {maxResolution: "auto", bufferImgCount: 0});
    layer.bufferImgCount = 0;
    layer.events.on({"layerInitialized": addLayer});
    vectorLayer = new SuperMap.Layer.Vector("Vector Layer");
    markerLayer = new SuperMap.Layer.Markers("Markers");
}
function addLayer() {
    var center = new SuperMap.LonLat(0,0);
    map.addLayers([layer,vectorLayer,markerLayer]);
    map.setCenter(center, 3);
}

/***************************点击获取结果点数据******************************************/
function getCurrentCoord(event){
    clearStatus();
//    drawPoint.activate();
    //手动注册监听
   map.events.un({"mouseup": getCurrentCoord});
    //获取相对于地图视口的屏幕坐标
    var px = event.xy;
    var lon=map.getLonLatFromPixel(px).lon;
    var lat=map.getLonLatFromPixel(px).lat;
    document.getElementById("ptDst").value ="{'x':"+lon+",'y':"+lat+"}";

    if(markerLayer.markers.length>0){
        markerLayer.clearMarkers();
    }
    //在地图上具体位置上画一个图形,标记点击的位置
    var point =  new SuperMap.Geometry.Point(lon,lat),//构造一个点的几何图形,
            size = new SuperMap.Size(11, 10),
            offset = new SuperMap.Pixel(-(size.w/2), -size.h),
            icon = new SuperMap.Icon("./theme/images/marker-gold.png", size, offset);
    markerLayer.addMarker(new SuperMap.Marker(new SuperMap.LonLat(point.x, point.y), icon));

}

//画点成功回调函数，加了个符号标识
function selectedPointCompleted(eventArgs){
    drawPoint.deactivate();
    var geometry = eventArgs.feature.geometry;

    //获取相对于地图视口的屏幕坐标
//    var px = event.xy;
    var lon=geometry.x;//
    var lat=geometry.y;//
    alert(lon+","+lat);
    document.getElementById("ptDst").value ="{'x':"+lon+",'y':"+lat+"}";

    if(markerLayer.markers.length>0){
        markerLayer.clearMarkers();
    }
    //在地图上具体位置上画一个图形,标记点击的位置
    var point =  new SuperMap.Geometry.Point(lon,lat),//构造一个点的几何图形,
            size = new SuperMap.Size(11, 10),
            offset = new SuperMap.Pixel(-(size.w/2), -size.h),
            icon = new SuperMap.Icon("./theme/images/marker-gold.png", size, offset);
    markerLayer.addMarker(new SuperMap.Marker(new SuperMap.LonLat(point.x, point.y), icon));

    //调用组件方法进行处理
}

//平移地图
function panMethod(){
    //激活控件
    drawLine .deactivate();
    drawPoint.deactivate();
    dragPan.activate();
}
//清空图层
function clearStatus(){
    vectorLayer.removeAllFeatures();
    markerLayer.clearMarkers();
}
</script>
</head>
<body onload="onload()">
<table width="50%" id="tab" name="tab" >
    <tr>
        <td><div id="map" style="float:left;width: 700px;height: 450px"></div></td>
        <td><div id="result" style="position:relative;z-index:9;float: right;"></div></td>
    </tr>
    <tr>
        <table width="50%" id="pram" name="pram">
            <tr>
                <td><label  style="margin-left: 0;">点坐标：</label></td>
                <td> <input type="text" name="ptDst" id="ptDst" value="{'x':115.879072,'y':28.65218825}" size="30"></td>
            </tr>
        </table>
    </tr>
</table>
</body>
</html>