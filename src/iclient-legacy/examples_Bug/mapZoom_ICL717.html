<!DOCTYPE>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>TiledDynamicRESTLayer</title>
        <style type="text/css">
            body{
                margin: 0;
                overflow: hidden;
                background: #fff;
            }
            #map{
                position: relative;
                height: 100%;
                width: 100%;
                border:1px solid #3473b7;
            }
            #toolbar{
                position: relative;
                height: 33px;

            }
            #btn{
                margin-top: 5px;
            }
        </style>
        <script src='../libs/SuperMap.Include.js'></script>
        <script type="text/javascript">
            var map, baseLayer, worldLayer, jingjinLayer,
            host = "http://localhost:8090",
            //作为底图，否则下面两个缓存只能缩放第一个。
            baselayerUrl = host + "/iserver/services/maps/rest/maps/世界地图",
            //原始服务
            // worldUrl = host + "/iserver/services/map-world/rest/maps/World",
            // 制作的地图缓存服务，切缓存的比例尺为：1/120000000, 1/80000000, 1/40000000
            worldUrl = host + "/iserver/services/map-world2/rest/maps/World",
            // 原始服务
            // jingjinUrl = host + "/iserver/services/map-jingjin/rest/maps/京津地区地图";
            // 制作的地图缓存服务，切缓存的比例尺为：1/20000000, 1/10000000, 1/5000000
            jingjinUrl = host + "/iserver/services/map-jingjin2/rest/maps/京津地区地图";
            
            function init(){
                map = new SuperMap.Map("map",{controls: [
                    new SuperMap.Control.ScaleLine(),
                    new SuperMap.Control.Zoom(),
                    new SuperMap.Control.LayerSwitcher(),
                    new SuperMap.Control.Navigation({
                        dragPanOptions: {
                            enableKinetic: true
                        }
                    })],
                    scales: [1/120000000, 1/80000000, 1/40000000, 1/20000000, 1/10000000, 1/5000000],
                    allOverlays: true
                });
                
                //初始化图层
                baseLayer = new SuperMap.Layer.TiledDynamicRESTLayer(
                        "baseLayer",
                        baselayerUrl,
                        {transparent: true,cacheEnabled: true},
                        {
                            dpi:96.00000000000072,
                            maxExtent:new SuperMap.Bounds(-180,-90,180,90),
                            scales: [1/120000000, 1/80000000, 1/40000000, 1/20000000, 1/10000000, 1/5000000],
                            maxResolution:"auto"
                        }
                );
                worldLayer = new SuperMap.Layer.TiledDynamicRESTLayer(
                        "worldLayer",
                        worldUrl,
                        {transparent: true, cacheEnabled: true},
                        {
                            dpi:96.00000000000072,
                            maxExtent:new SuperMap.Bounds(-180,-90,180,90),
                            scales: [1/120000000, 1/80000000, 1/40000000],
                            maxResolution:"auto"
                        }
                );
                jingjinLayer = new SuperMap.Layer.TiledDynamicRESTLayer(
                        "jingjinLayer",
                        jingjinUrl,
                        {transparent: true, cacheEnabled: true},
                        {
                            dpi:96.00000000000072,
                            maxExtent:new SuperMap.Bounds(114.74 , 37.9,119.25 , 42.15),
                            scales: [1/20000000, 1/10000000, 1/5000000],
                            maxResolution:"auto"
                        }
                );
                var center = new SuperMap.LonLat(116.998448574742, 40.0224288148081);
                map.addLayers([baseLayer,worldLayer]);
                map.setCenter(center, 0);
                map.events.register("zoomend", null, onZoomEnd);
            }



            /**
             * 地图放大缩小触发方法
             */
            function onZoomEnd() {
                //当缩小到第四级别的时候，切换地图。
                if (map.getZoom() >= 3 && map.getLayersByName("worldLayer").length > 0 && map.getLayersByName("jingjinLayer").length <= 0) {
                    map.removeLayer(worldLayer);
                    map.addLayer(jingjinLayer);
                }
                if (map.getZoom() < 3 && map.getLayersByName("worldLayer").length <= 0 && map.getLayersByName("jingjinLayer").length > 0) {
                    map.removeLayer(jingjinLayer);
                    map.addLayer(worldLayer);
                }
            }

            
        </script>
    </head>
    <body onload="init()">
        <div id="map"></div>
    </body>
</html>
