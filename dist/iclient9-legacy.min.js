/*!
 * 
 *     iclient9-legacy.(http://iclient.supermapol.com)
 *     Copyright© 2000-2017 SuperMap Software Co. Ltd
 *     license: Apache-2.0
 *     version: v9.0.0
 * 
 */
!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e){t.exports=window.SuperMap},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,n,i)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(i)},h=n(0),p={};try{p=n(3)}catch(t){p={}}var c=p.baiduMapLayer?p.baiduMapLayer.__proto__:Function,u=function(t){function e(t,n,a,s){if(i(this,e),!c)return o(r);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,a,s)),h=r;return s=s||{},h.init(s),h.argCheck(s),r.canvasLayer=n,h.transferToMercator(),r.clickEvent=r.clickEvent.bind(r),r.mousemoveEvent=r.mousemoveEvent.bind(r),r.bindEvent(),r}return a(e,c),s(e,[{key:"clickEvent",value:function(t){var n=t.layerPoint;r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clickEvent",this).call(this,n,t)}},{key:"mousemoveEvent",value:function(t){var n=t.layerPoint;r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"mousemoveEvent",this).call(this,n,t)}},{key:"bindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.events.on({click:this.clickEvent}),this.options.methods.mousemove&&e.events.on({mousemove:this.mousemoveEvent}))}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.events.un({click:this.clickEvent}),this.options.methods.mousemove&&e.events.un({mousemove:this.mousemoveEvent}))}},{key:"getContext",value:function(){return this.canvasLayer&&this.canvasLayer.canvasContext}},{key:"addData",value:function(t,e){var n=t;t&&t.get&&(n=t.get()),this.dataSet.add(n),this.update({options:e})}},{key:"setData",value:function(t,e){var n=t;t&&t.get&&(n=t.get()),this.dataSet=this.dataSet||new p.DataSet,this.dataSet.set(n),this.update({options:e})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(t){if(this.dataSet){var e=this.dataSet.get(t);this.dataSet.set(e),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"render",value:function(t){this._canvasUpdate(t)}},{key:"transferToMercator",value:function(){if(this.options.coordType&&["bd09mc","coordinates_mercator"].indexOf(this.options.coordType)>-1){var t=this.dataSet.get();t=this.dataSet.transferCoordinate(t,function(t){var e=h.Projection.transform({x:t[0],y:t[1]},"EPSG:3857","EPSG:4326");return[e.x,e.y]},"coordinates","coordinates"),this.dataSet._set(t)}}},{key:"_canvasUpdate",value:function(t){if(this.canvasLayer){var e=this,n=e.options.animation,i=this.getContext(),o=this.map;if(e.isEnabledTime()){if(void 0===t)return void this.clear(i);"2d"===this.context&&(i.save(),i.globalCompositeOperation="destination-out",i.fillStyle="rgba(0, 0, 0, .1)",i.fillRect(0,0,i.canvas.width,i.canvas.height),i.restore())}else this.clear(i);if("2d"===this.context)for(var a in e.options)i[a]=e.options[a];else i.clear(i.COLOR_BUFFER_BIT);if(!(e.options.minZoom&&o.getZoom()<e.options.minZoom||e.options.maxZoom&&o.getZoom()>e.options.maxZoom)){var s=e.canvasLayer,r={fromColumn:"coordinates",transferCoordinate:function(t){var e=s.transferToMapLatLng({lon:t[0],lat:t[1]}),n=o.getViewPortPxFromLonLat(e);return[n.x,n.y]}};void 0!==t&&(r.filter=function(e){var i=n.trails||10;return t&&e.time>t-i&&e.time<t});var h=e.dataSet.get(r);this.processData(h),e.options._size=e.options.size;var c=o.getViewPortPxFromLonLat(s.transferToMapLatLng({lon:0,lat:0})),u=Math.pow(2,14-o.getZoom());"m"==e.options.unit?(e.options.size&&(e.options._size=e.options.size/u),e.options.width&&(e.options._width=e.options.width/u),e.options.height&&(e.options._height=e.options.height/u)):(e.options._size=e.options.size,e.options._height=e.options.height,e.options._width=e.options.width),this.drawContext(i,new p.DataSet(h),e.options,c),e.options.updateCallback&&e.options.updateCallback(t)}}}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.events.on({movestart:this.animatorMovestartEvent.bind(this)}),this.map.events.on({moveend:this.animatorMoveendEvent.bind(this)})}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"show",value:function(){this.map.addLayer(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeLayer(this.canvasLayer)}},{key:"draw",value:function(){this.canvasLayer.redraw()}}]),e}();t.exports=u},function(t,e,n){var i=n(0),o=n(1);i.Layer.MapVLayer=i.Class(i.Layer,{dataSet:null,options:null,supported:!1,canvas:null,canvasContext:null,initialize:function(t,e){if(this.EVENT_TYPES=i.Layer.prototype.EVENT_TYPES,i.Layer.prototype.initialize.apply(this,arguments),this.canvas=document.createElement("canvas"),this.canvas.getContext){this.supported=!0,this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style.left="0px",this.div.appendChild(this.canvas);var n=this.options.context||"2d";this.canvasContext=this.canvas.getContext(n),this.attribution="© 2017 百度 MapV with <a target='_blank' href='http://iclient.supermapol.com' style='color: #08c;text-decoration: none;'>SuperMap iClient</a>"}},destroy:function(){this.dataSet=null,this.options=null,this.renderer=null,this.supported=null,this.canvas=null,this.canvasContext=null,this.maxWidth=null,this.maxHeight=null,i.Layer.prototype.destroy.apply(this,arguments)},addData:function(t,e){this.renderer&&this.renderer.addData(t,e)},setData:function(t,e){this.renderer&&this.renderer.setData(t,e)},getData:function(){return this.renderer&&(this.dataSet=this.renderer.getData()),this.dataSet},removeData:function(t){this.renderer&&this.renderer.removeData(t)},clearData:function(){this.renderer.clearData()},setMap:function(t){i.Layer.prototype.setMap.apply(this,arguments),this.renderer=new o(t,this,this.dataSet,this.options),this.supported?this.redraw():this.map.removeLayer(this)},moveTo:function(t,e,n){if(i.Layer.prototype.moveTo.apply(this,arguments),this.supported){if(this.zoomChanged=e,!n){this.div.style.visibility="hidden",this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px",this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var o=this.map.getSize();this.div.style.width=parseInt(o.w)+"px",this.div.style.height=parseInt(o.h)+"px",this.canvas.width=parseInt(o.w),this.canvas.height=parseInt(o.h),this.canvas.style.width=this.div.style.width,this.canvas.style.height=this.div.style.height,this.maxWidth=o.w,this.maxHeight=o.h,this.div.style.visibility="",e||this.renderer&&this.renderer.render()}e&&this.renderer&&this.renderer.render()}},transferToMapLatLng:function(t){var e="EPSG:4326",n=this.map.getUnits();return["m","meter"].indexOf(n.toLowerCase())>-1&&(e="EPSG:3857"),new i.LonLat(t.lon,t.lat).transform("EPSG:4326",e)},CLASS_NAME:"SuperMap.Layer.MapVLayer"}),t.exports=i.Layer.MapVLayer},function(t,e){if("undefined"==typeof mapv){var n=new Error('Cannot find module "mapv"');throw n.code="MODULE_NOT_FOUND",n}t.exports=mapv}]);