/*!
 * 
 *     iclient9-legacy.(http://iclient.supermapol.com)
 *     CopyrightÂ© 2000-2017 SuperMap Software Co. Ltd
 *     license: Apache-2.0
 *     version: v9.0.0
 * 
 */
!function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=33)}([function(e,t,r){"use strict";r(6),r(6),e.exports=window.SuperMap},function(e,t,r){"use strict";var n=r(2),i=r(0),s=r(5);i.ProcessingServiceBase=i.Class(n,{EVENT_TYPES:["processCompleted","processFailed","processRunning"],initialize:function(e,t){n.prototype.initialize.apply(this,arguments)},destroy:function(){n.prototype.destroy.apply(this,arguments)},getJobs:function(e){var t=this;return s.get(e).then(function(e){return e.json()}).then(function(e){t.events.triggerEvent("processCompleted",{result:e})}).catch(function(e){t.eventListeners.processFailed({error:e})})},addJob:function(e,t,r,n){var i=this,o=null;t&&t instanceof r&&(o=new Object,r.toObject(t,o));var a={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return s.post(i._processUrl(e),JSON.stringify(o),a).then(function(e){return e.json()}).then(function(e){e.succeed?i.serviceProcessCompleted(e,n):i.serviceProcessFailed(e)}).catch(function(e){i.eventListeners.processFailed({error:e})})},serviceProcessCompleted:function(e,t){e=i.Util.transformResult(e),t=t||1e3;var r=this;if(e)var n=setInterval(function(){return s.get(e.newResourceLocation).then(function(e){return e.json()}).then(function(e){r.events.triggerEvent("processRunning",{id:e.id,state:e.state}),"LOST"===e.state.runState&&(clearInterval(n),r.events.triggerEvent("processFailed",{error:e.state.errorMsg})),"FINISHED"===e.state.runState&&e.setting.serviceInfo&&(clearInterval(n),r.events.triggerEvent("processCompleted",{result:e}))}).catch(function(e){clearInterval(n),r.events.triggerEvent("processFailed",{error:e})})},t)},serviceProcessFailed:function(e){n.prototype.serviceProcessFailed.apply(this,arguments)},_processUrl:function(e){return-1===e.indexOf(".json")&&(e+=".json"),i.SecurityManager.getToken(e)&&(e+="?token="+i.SecurityManager.getToken(e)),e},CLASS_NAME:"SuperMap.ProcessingServiceBase"}),e.exports=i.ProcessingServiceBase},function(e,t,r){"use strict";r(26);var n=r(0);n.ServiceBase=n.Class({EVENT_TYPES:["processCompleted","processFailed"],events:null,eventListeners:null,url:null,urls:null,serverType:null,index:null,length:null,options:null,totalTimes:null,POLLING_TIMES:3,_processSuccess:null,_processFailed:null,isInTheSameDomain:null,initialize:function(e,t){if(!e)return!1;var r=this;n.Util.isArray(e)?(r.urls=e,r.length=e.length,r.totalTimes=r.length,1===r.length?r.url=e[0]:(r.index=parseInt(Math.random()*r.length),r.url=e[r.index])):(r.totalTimes=1,r.url=e),n.Util.isArray(e)&&!r.isServiceSupportPolling()&&(r.url=e[0],r.totalTimes=1),r.serverType=r.serverType||n.ServerType.ISERVER,(t=t||{})&&n.Util.extend(this,t),r.isInTheSameDomain=n.Util.isInTheSameDomain(r.url),r.events=new n.Events(r,null,r.EVENT_TYPES,!0),r.eventListeners instanceof Object&&r.events.on(r.eventListeners)},destroy:function(){var e=this;n.Util.isArray(e.urls)&&(e.urls=null,e.index=null,e.length=null,e.totalTimes=null),e.url=null,e.options=null,e._processSuccess=null,e._processFailed=null,e.isInTheSameDomain=null,e.EVENT_TYPES=null,e.events&&(e.events.destroy(),e.events=null),e.eventListeners&&(e.eventListeners=null)},request:function(e){var t=this;e.url=e.url||t.url,e.isInTheSameDomain=t.isInTheSameDomain;var r=this.getCredential(e.url);if(r){var i=e.url.substring(e.url.length-1,e.url.length);e.url.indexOf("?")>-1&&"?"===i?e.url+=r.getUrlParameters():e.url.indexOf("?")>-1&&"?"!==i?e.url+="&"+r.getUrlParameters():e.url+="?"+r.getUrlParameters()}t.calculatePollingTimes(),t._processSuccess=e.success,t._processFailed=e.failure,e.scope=t,e.success=t.getUrlCompleted,e.failure=t.getUrlFailed,t.options=e,n.Util.committer(t.options)},getCredential:function(e){var t,r,i=e;switch(this.serverType){case n.ServerType.ISERVER:t=(r=n.SecurityManager.getToken(i))?new n.Credential(r,"token"):null;break;case n.ServerType.IPORTAL:(t=(r=n.SecurityManager.getToken(i))?new n.Credential(r,"token"):null)||(t=(r=n.SecurityManager.getKey(i))?new n.Credential(r,"key"):null);break;case n.ServerType.ONLINE:t=(r=n.SecurityManager.getKey(i))?new n.Credential(r,"key"):null;break;default:t=(r=n.SecurityManager.getToken(i))?new n.Credential(r,"token"):null}return t},getUrlCompleted:function(e){this._processSuccess(e)},getUrlFailed:function(e){var t=this;t.totalTimes>0?(t.totalTimes--,t.ajaxPolling()):t._processFailed(e)},ajaxPolling:function(){var e=this,t=e.options.url,r=/^http:\/\/([a-z]{9}|(\d+\.){3}\d+):\d{0,4}/;e.index=parseInt(Math.random()*e.length),e.url=e.urls[e.index],t=t.replace(r,r.exec(e.url)[0]);var i=n.Util.isInTheSameDomain(t);i?t.indexOf(".jsonp")>0&&(t=t.replace(/.jsonp/,".json")):t.indexOf(".jsonp")>0||(t=t.replace(/.json/,".jsonp")),e.options.url=t,e.options.isInTheSameDomain=i,n.Util.committer(e.options)},calculatePollingTimes:function(){var e=this;e.times?e.totalTimes>e.POLLING_TIMES?e.times>e.POLLING_TIMES?e.totalTimes=e.POLLING_TIMES:e.totalTimes=e.times:e.times<e.totalTimes&&(e.totalTimes=e.times):e.totalTimes>e.POLLING_TIMES&&(e.totalTimes=e.POLLING_TIMES),e.totalTimes--},isServiceSupportPolling:function(){var e=this;return!("SuperMap.REST.ThemeService"===e.CLASS_NAME||"SuperMap.REST.EditFeaturesService"===e.CLASS_NAME)},serviceProcessCompleted:function(e){e=n.Util.transformResult(e),this.events.triggerEvent("processCompleted",{result:e})},serviceProcessFailed:function(e){var t=(e=n.Util.transformResult(e)).error||e;this.events.triggerEvent("processFailed",{error:t})},CLASS_NAME:"SuperMap.ServiceBase"}),e.exports=n.ServiceBase},function(e,t,r){"use strict";e.exports=window.SuperMap},function(e,t,r){"use strict";var n=r(0);n.DataFormat={GEOJSON:"GEOJSON",ISERVER:"ISERVER"},n.GeometryType={LINE:"LINE",LINEM:"LINEM",POINT:"POINT",REGION:"REGION",ELLIPSE:"ELLIPSE",CIRCLE:"CIRCLE",TEXT:"TEXT",UNKNOWN:"UNKNOWN"},n.QueryOption={ATTRIBUTE:"ATTRIBUTE",ATTRIBUTEANDGEOMETRY:"ATTRIBUTEANDGEOMETRY",GEOMETRY:"GEOMETRY"},n.JoinType={INNERJOIN:"INNERJOIN",LEFTJOIN:"LEFTJOIN"},n.SpatialQueryMode={CONTAIN:"CONTAIN",CROSS:"CROSS",DISJOINT:"DISJOINT",IDENTITY:"IDENTITY",INTERSECT:"INTERSECT",NONE:"NONE",OVERLAP:"OVERLAP",TOUCH:"TOUCH",WITHIN:"WITHIN"},n.SpatialRelationType={CONTAIN:"CONTAIN",INTERSECT:"INTERSECT",WITHIN:"WITHIN"},n.MeasureMode={DISTANCE:"DISTANCE",AREA:"AREA"},n.Unit={METER:"METER",KILOMETER:"KILOMETER",MILE:"MILE",YARD:"YARD",DEGREE:"DEGREE",MILLIMETER:"MILLIMETER",CENTIMETER:"CENTIMETER",INCH:"INCH",DECIMETER:"DECIMETER",FOOT:"FOOT",SECOND:"SECOND",MINUTE:"MINUTE",RADIAN:"RADIAN"},n.EngineType={IMAGEPLUGINS:"IMAGEPLUGINS",OGC:"OGC",ORACLEPLUS:"ORACLEPLUS",SDBPLUS:"SDBPLUS",SQLPLUS:"SQLPLUS",UDB:"UDB"},n.ThemeGraphTextFormat={CAPTION:"CAPTION",CAPTION_PERCENT:"CAPTION_PERCENT",CAPTION_VALUE:"CAPTION_VALUE",PERCENT:"PERCENT",VALUE:"VALUE"},n.ThemeGraphType={AREA:"AREA",BAR:"BAR",BAR3D:"BAR3D",LINE:"LINE",PIE:"PIE",PIE3D:"PIE3D",POINT:"POINT",RING:"RING",ROSE:"ROSE",ROSE3D:"ROSE3D",STACK_BAR:"STACK_BAR",STACK_BAR3D:"STACK_BAR3D",STEP:"STEP"},n.GraphAxesTextDisplayMode={ALL:"ALL",NONE:"NONE",YAXES:"YAXES"},n.GraduatedMode={CONSTANT:"CONSTANT",LOGARITHM:"LOGARITHM",SQUAREROOT:"SQUAREROOT"},n.RangeMode={CUSTOMINTERVAL:"CUSTOMINTERVAL",EQUALINTERVAL:"EQUALINTERVAL",LOGARITHM:"LOGARITHM",QUANTILE:"QUANTILE",SQUAREROOT:"SQUAREROOT",STDDEVIATION:"STDDEVIATION"},n.ThemeType={DOTDENSITY:"DOTDENSITY",GRADUATEDSYMBOL:"GRADUATEDSYMBOL",GRAPH:"GRAPH",LABEL:"LABEL",RANGE:"RANGE",UNIQUE:"UNIQUE"},n.ColorGradientType={BLACK_WHITE:"BLACKWHITE",BLUE_BLACK:"BLUEBLACK",BLUE_RED:"BLUERED",BLUE_WHITE:"BLUEWHITE",CYAN_BLACK:"CYANBLACK",CYAN_BLUE:"CYANBLUE",CYAN_GREEN:"CYANGREEN",CYAN_WHITE:"CYANWHITE",GREEN_BLACK:"GREENBLACK",GREEN_BLUE:"GREENBLUE",GREEN_ORANGE_VIOLET:"GREENORANGEVIOLET",GREEN_RED:"GREENRED",GREEN_WHITE:"GREENWHITE",PINK_BLACK:"PINKBLACK",PINK_BLUE:"PINKBLUE",PINK_RED:"PINKRED",PINK_WHITE:"PINKWHITE",RAIN_BOW:"RAINBOW",RED_BLACK:"REDBLACK",RED_WHITE:"REDWHITE",SPECTRUM:"SPECTRUM",TERRAIN:"TERRAIN",YELLOW_BLACK:"YELLOWBLACK",YELLOW_BLUE:"YELLOWBLUE",YELLOW_GREEN:"YELLOWGREEN",YELLOW_RED:"YELLOWRED",YELLOW_WHITE:"YELLOWWHITE"},n.TextAlignment={TOPLEFT:"TOPLEFT",TOPCENTER:"TOPCENTER",TOPRIGHT:"TOPRIGHT",BASELINELEFT:"BASELINELEFT",BASELINECENTER:"BASELINECENTER",BASELINERIGHT:"BASELINERIGHT",BOTTOMLEFT:"BOTTOMLEFT",BOTTOMCENTER:"BOTTOMCENTER",BOTTOMRIGHT:"BOTTOMRIGHT",MIDDLELEFT:"MIDDLELEFT",MIDDLECENTER:"MIDDLECENTER",MIDDLERIGHT:"MIDDLERIGHT"},n.FillGradientMode={NONE:"NONE",LINEAR:"LINEAR",RADIAL:"RADIAL",CONICAL:"CONICAL",SQUARE:"SQUARE"},n.AlongLineDirection={NORMAL:"ALONG_LINE_NORMAL",LB_TO_RT:"LEFT_BOTTOM_TO_RIGHT_TOP",LT_TO_RB:"LEFT_TOP_TO_RIGHT_BOTTOM",RB_TO_LT:"RIGHT_BOTTOM_TO_LEFT_TOP",RT_TO_LB:"RIGHT_TOP_TO_LEFT_BOTTOM"},n.LabelBackShape={DIAMOND:"DIAMOND",ELLIPSE:"ELLIPSE",MARKER:"MARKER",NONE:"NONE",RECT:"RECT",ROUNDRECT:"ROUNDRECT",TRIANGLE:"TRIANGLE"},n.LabelOverLengthMode={NEWLINE:"NEWLINE",NONE:"NONE",OMIT:"OMIT"},n.DirectionType={EAST:"EAST",NONE:"NONE",NORTH:"NORTH",SOURTH:"SOURTH",WEST:"WEST"},n.SideType={LEFT:"LEFT",MIDDLE:"MIDDLE",NONE:"NONE",RIGHT:"RIGHT"},n.SupplyCenterType={FIXEDCENTER:"FIXEDCENTER",NULL:"NULL",OPTIONALCENTER:"OPTIONALCENTER"},n.TurnType={AHEAD:"AHEAD",BACK:"BACK",END:"END",LEFT:"LEFT",NONE:"NONE",RIGHT:"RIGHT"},n.BufferEndType={FLAT:"FLAT",ROUND:"ROUND"},n.OverlayOperationType={CLIP:"CLIP",ERASE:"ERASE",IDENTITY:"IDENTITY",INTERSECT:"INTERSECT",UNION:"UNION",UPDATE:"UPDATE",XOR:"XOR"},n.SmoothMethod={BSPLINE:"BSPLINE",POLISH:"POLISH"},n.SurfaceAnalystMethod={ISOLINE:"ISOLINE",ISOREGION:"ISOREGION"},n.DataReturnMode={DATASET_AND_RECORDSET:"DATASET_AND_RECORDSET",DATASET_ONLY:"DATASET_ONLY",RECORDSET_ONLY:"RECORDSET_ONLY"},n.EditType={ADD:"add",UPDATE:"update",DELETE:"delete"},n.TransferTactic={LESS_TIME:"LESS_TIME",LESS_TRANSFER:"LESS_TRANSFER",LESS_WALK:"LESS_WALK",MIN_DISTANCE:"MIN_DISTANCE"},n.TransferPreference={BUS:"BUS",SUBWAY:"SUBWAY",NO_SUBWAY:"NO_SUBWAY",NONE:"NONE"},n.GridType={CROSS:"CROSS",GRID:"GRID",POINT:"POINT"},n.ColorSpaceType={CMYK:"CMYK",RGB:"RGB"},n.LayerType={UGC:"UGC",WMS:"WMS",WFS:"WFS",CUSTOM:"CUSTOM"},n.StatisticMode={AVERAGE:"AVERAGE",MAX:"MAX",MIN:"MIN",STDDEVIATION:"STDDEVIATION",SUM:"SUM",VARIANCE:"VARIANCE"},n.PixelFormat={BIT16:"BIT16",BIT32:"BIT32",BIT64:"BIT64",SINGLE:"SINGLE",DOUBLE:"DOUBLE",UBIT1:"UBIT1",UBIT4:"UBIT4",UBIT8:"UBIT8",UBIT24:"UBIT24",UBIT32:"UBIT32"},n.SearchMode={KDTREE_FIXED_COUNT:"KDTREE_FIXED_COUNT",KDTREE_FIXED_RADIUS:"KDTREE_FIXED_RADIUS",NONE:"NONE",QUADTREE:"QUADTREE"},n.InterpolationAlgorithmType={KRIGING:"KRIGING",SimpleKriging:"SimpleKriging",UniversalKriging:"UniversalKriging"},n.VariogramMode={EXPONENTIAL:"EXPONENTIAL",GAUSSIAN:"GAUSSIAN",SPHERICAL:"SPHERICAL"},n.Exponent={EXP1:"EXP1",EXP2:"EXP2"},n.ServerType={ISERVER:"ISERVER",IPORTAL:"IPORTAL",ONLINE:"ONLINE"},n.ClientType={IP:"IP",REFERER:"Referer",REQUESTIP:"RequestIP",NONE:"NONE",SERVER:"SERVER",WEB:"WEB"},n.ChartType={BAR:"Bar",BAR3D:"Bar3D",CIRCLE:"Circle",PIE:"Pie",POINT:"Point",LINE:"Line",RING:"Ring"},n.ClipAnalystMode={CLIP:"clip",INTERSECT:"intersect"}},function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r(31);var i=r(30),s=r(0);s.Support={cors:window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest},s.FetchRequest={commit:function(e,t,r,n){switch(e=e?e.toUpperCase():e){case"GET":return this.get(t,r,n);case"POST":return this.post(t,r,n);case"PUT":return this.put(t,r,n);case"DELETE":return this.delete(t,r,n);default:return this.get(t,r,n)}},get:function(e,t,r){if(e=this._processUrl(e),(e=s.Util.urlAppend(e,this._getParameterString(t||{}))).length<=2e3){if(s.Util.isInTheSameDomain(e)||s.Support.cors&&this._isMVTRequest(e))return this._fetch(e,t,r,"GET");if(!s.Util.isInTheSameDomain(e))return e=e.replace(".json",".jsonp"),this._fetchJsonp(e,r)}return this._postSimulatie("GET",e.substring(0,e.indexOf("?")-1),t,r)},delete:function(e,t,r){return e=this._processUrl(e),(e=s.Util.urlAppend(e,this._getParameterString(t||{}))).length<=2e3&&s.Support.cors?this._fetch(e,t,r,"DELETE"):this._postSimulatie("DELETE",e.substring(0,e.indexOf("?")-1),t,r)},post:function(e,t,r){return this._fetch(this._processUrl(e),t,r,"POST")},put:function(e,t,r){return this._fetch(this._processUrl(e),t,r,"PUT")},_postSimulatie:function(e,t,r,n){return t+=(t.indexOf("?")>-1?"&":"?")+"_method= "+e,this.post(t,r,n)},_processUrl:function(e){if(this._isMVTRequest(e))return e;if(-1===e.indexOf(".json"))if(e.indexOf("?")<0)e+=".json";else{var t=e.split("?");2===t.length&&(e=t[0]+".json?"+t[1])}return e},_fetch:function(e,t,r,n){return r=r||{},r.headers=r.headers||{},r.headers["Content-Type"]||(r.headers["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8"),r.timeout?this._timeout(r.timeout,fetch(e,{method:n,headers:r.headers,body:"PUT"===n||"POST"===n?t:void 0,credentials:r.withCredentials?"include":"omit",mode:"cors"}).then(function(e){return e})):fetch(e,{method:n,body:"PUT"===n||"POST"===n?t:void 0,headers:r.headers,credentials:r.withCredentials?"include":"omit",mode:"cors"}).then(function(e){return e})},_fetchJsonp:function(e,t){return t=t||{},i(e,{method:"GET",timeout:t.timeout}).then(function(e){return e})},_timeout:function(e,t){return new Promise(function(r,n){setTimeout(function(){n(new Error("timeout"))},e),t.then(r,n)})},_getParameterString:function(e){var t=[];for(var r in e){var i=e[r];if(null!=i&&"function"!=typeof i){var s;if("object"===(void 0===i?"undefined":n(i))&&i.constructor===Array){for(var o,a=[],u=0,l=i.length;u<l;u++)o=i[u],a.push(encodeURIComponent(null===o||void 0===o?"":o));s="["+a.join(",")+"]"}else s=encodeURIComponent(i);t.push(encodeURIComponent(r)+"="+s)}}return t.join("&")},_isMVTRequest:function(e){return e.indexOf(".mvt")>-1||e.indexOf(".pbf")>-1}},e.exports=s.FetchRequest},function(e,t){e.exports=SuperMap},function(e,t,r){"use strict";var n=r(3),i=r(29);n.Layer.MapVLayer=n.Class(n.Layer,{dataSet:null,options:null,supported:!1,canvas:null,canvasContext:null,initialize:function(e,t){if(this.EVENT_TYPES=n.Layer.prototype.EVENT_TYPES,n.Layer.prototype.initialize.apply(this,arguments),this.canvas=document.createElement("canvas"),this.canvas.getContext){this.supported=!0,this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style.left="0px",this.div.appendChild(this.canvas);var r=this.options.context||"2d";this.canvasContext=this.canvas.getContext(r),this.attribution="Â© 2017 ç¾åº¦ MapV with <a target='_blank' href='http://iclient.supermapol.com' style='color: #08c;text-decoration: none;'>SuperMap iClient</a>"}},destroy:function(){this.dataSet=null,this.options=null,this.renderer=null,this.supported=null,this.canvas=null,this.canvasContext=null,this.maxWidth=null,this.maxHeight=null,n.Layer.prototype.destroy.apply(this,arguments)},addData:function(e,t){this.renderer&&this.renderer.addData(e,t)},setData:function(e,t){this.renderer&&this.renderer.setData(e,t)},getData:function(){return this.renderer&&(this.dataSet=this.renderer.getData()),this.dataSet},removeData:function(e){this.renderer&&this.renderer.removeData(e)},clearData:function(){this.renderer.clearData()},setMap:function(e){n.Layer.prototype.setMap.apply(this,arguments),this.renderer=new i(e,this,this.dataSet,this.options),this.supported?this.redraw():this.map.removeLayer(this)},moveTo:function(e,t,r){if(n.Layer.prototype.moveTo.apply(this,arguments),this.supported){if(this.zoomChanged=t,!r){this.div.style.visibility="hidden",this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px",this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var i=this.map.getSize();this.div.style.width=parseInt(i.w)+"px",this.div.style.height=parseInt(i.h)+"px",this.canvas.width=parseInt(i.w),this.canvas.height=parseInt(i.h),this.canvas.style.width=this.div.style.width,this.canvas.style.height=this.div.style.height,this.maxWidth=i.w,this.maxHeight=i.h,this.div.style.visibility="",t||this.renderer&&this.renderer.render()}t&&this.renderer&&this.renderer.render()}},transferToMapLatLng:function(e){var t="EPSG:4326",r=this.map.getUnits();return["m","meter"].indexOf(r.toLowerCase())>-1&&(t="EPSG:3857"),new n.LonLat(e.lon,e.lat).transform("EPSG:4326",t)},CLASS_NAME:"SuperMap.Layer.MapVLayer"}),e.exports=n.Layer.MapVLayer},function(e,t,r){"use strict";var n=r(3),i=r(2),s=r(10);n.REST.AddressMatchService=n.Class(i,{initialize:function(e,t){i.prototype.initialize.apply(this,arguments)},code:function(e,t,r){var n=this,i=n._processFormat(r);return new s(n.url,{serverType:n.serverType,eventListeners:{scope:n,processCompleted:t,processFailed:t},format:i}).code(n.url+"/geocoding",e),n},decode:function(e,t,r){var n=this,i=n._processFormat(r);return new s(n.url,{serverType:n.serverType,eventListeners:{scope:n,processCompleted:t,processFailed:t},format:i}).decode(n.url+"/geodecoding",e),n},_processFormat:function(e){return e||n.DataFormat.GEOJSON},CLASS_NAME:"SuperMap.REST.AddressMatchService"}),e.exports=n.REST.AddressMatchService},function(e,t,r){"use strict";var n=r(3),i=r(2),s=r(16),o=r(18),a=r(12),u=r(20),l=r(22),c=r(24);n.REST.ProcessingService=n.Class(i,{initialize:function(e,t){i.prototype.initialize.apply(this,arguments),this.kernelDensityJobs={},this.buildCacheJobs={},this.summaryMeshJobs={},this.queryJobs={},this.summaryRegionJobs={},this.vectorClipJobs={}},getKernelDensityJobs:function(e,t){var r=this,n=r._processFormat(t);return new s(r.url,{serverType:r.serverType,eventListeners:{scope:r,processCompleted:e,processFailed:e},format:n}).getKernelDensityJobs(),r},getKernelDensityJob:function(e,t,r){var n=this,i=n._processFormat(r);return new s(n.url,{serverType:n.serverType,eventListeners:{scope:n,processCompleted:t,processFailed:t},format:i}).getKernelDensityJob(e),n},addKernelDensityJob:function(e,t,r,n){var i=this,o=i._processParams(e),a=i._processFormat(n);return new s(i.url,{eventListeners:{scope:i,processCompleted:t,processFailed:t,processRunning:function(e){i.kernelDensityJobs[e.id]=e.state}},format:a}).addKernelDensityJob(o,r),i},getKernelDensityJobState:function(e){return this.kernelDensityJobs[e]},getSummaryMeshJobs:function(e,t){var r=this,n=r._processFormat(t);return new u(r.url,{serverType:r.serverType,eventListeners:{scope:r,processCompleted:e,processFailed:e},format:n}).getSummaryMeshJobs(),r},getSummaryMeshJob:function(e,t,r){var n=this,i=n._processFormat(r);return new u(n.url,{serverType:n.serverType,eventListeners:{scope:n,processCompleted:t,processFailed:t},format:i}).getSummaryMeshJob(e),n},addSummaryMeshJob:function(e,t,r,n){var i=this,s=i._processParams(e),o=i._processFormat(n);return new u(i.url,{eventListeners:{scope:i,processCompleted:t,processFailed:t,processRunning:function(e){i.summaryMeshJobs[e.id]=e.state}},format:o}).addSummaryMeshJob(s,r),i},getSummaryMeshJobState:function(e){return this.summaryMeshJobs[e]},getBuildCacheJobs:function(e,t){var r=this,n=r._processFormat(t);return new a(r.url,{serverType:r.serverType,eventListeners:{scope:r,processCompleted:e,processFailed:e},format:n}).getBuildCacheJobs(),r},getBuildCacheJob:function(e,t,r){var n=this,i=n._processFormat(r);return new a(n.url,{serverType:n.serverType,eventListeners:{scope:n,processCompleted:t,processFailed:t},format:i}).getBuildCacheJob(e),n},addBuildCacheJob:function(e,t,r,n){var i=this,s=i._processParams(e),o=i._processFormat(n);return new a(i.url,{eventListeners:{scope:i,processCompleted:t,processFailed:t,processRunning:function(e){i.buildCacheJobs[e.id]=e.state}},format:o}).addBuildCacheJob(s,r),i},getBuildCacheJobState:function(e){return this.buildCacheJobs[e]},getQueryJobs:function(e,t){var r=this,n=r._processFormat(t);return new o(r.url,{serverType:r.serverType,eventListeners:{scope:r,processCompleted:e,processFailed:e},format:n}).getQueryJobs(),r},getQueryJob:function(e,t,r){var n=this,i=n._processFormat(r);return new o(n.url,{serverType:n.serverType,eventListeners:{scope:n,processCompleted:t,processFailed:t},format:i}).getQueryJob(e),n},addQueryJob:function(e,t,r,n){var i=this,s=i._processParams(e),a=i._processFormat(n);return new o(i.url,{eventListeners:{scope:i,processCompleted:t,processFailed:t,processRunning:function(e){i.queryJobs[e.id]=e.state}},format:a}).addQueryJob(s,r),i},getQueryJobState:function(e){return this.queryJobs[e]},getSummaryRegionJobs:function(e,t){var r=this,n=r._processFormat(t);return new l(r.url,{serverType:r.serverType,eventListeners:{scope:r,processCompleted:e,processFailed:e},format:n}).getSummaryRegionJobs(),r},getSummaryRegionJob:function(e,t,r){var n=this,i=n._processFormat(r);return new l(n.url,{serverType:n.serverType,eventListeners:{scope:n,processCompleted:t,processFailed:t},format:i}).getSummaryRegionJob(e),n},addSummaryRegionJob:function(e,t,r,n){var i=this,s=i._processParams(e),o=i._processFormat(n);return new l(i.url,{eventListeners:{scope:i,processCompleted:t,processFailed:t,processRunning:function(e){i.summaryRegionJobs[e.id]=e.state}},format:o}).addSummaryRegionJob(s,r),i},getSummaryRegionJobState:function(e){return this.summaryRegionJobs[e]},getVectorClipJobs:function(e,t){var r=this,n=r._processFormat(t);return new c(r.url,{serverType:r.serverType,eventListeners:{scope:r,processCompleted:e,processFailed:e},format:n}).getVectorClipJobs(),r},getVectorClipJob:function(e,t,r){var n=this,i=n._processFormat(r);return new c(n.url,{serverType:n.serverType,eventListeners:{scope:n,processCompleted:t,processFailed:t},format:i}).getVectorClipJob(e),n},addVectorClipJob:function(e,t,r,n){var i=this,s=i._processParams(e),o=i._processFormat(n);return new c(i.url,{serverType:i.serverType,eventListeners:{scope:i,processCompleted:t,processFailed:t,processRunning:function(e){i.vectorClipJobs[e.id]=e.state}},format:o}).addVectorClipJob(s,r),i},getVectorClipJobState:function(e){return this.vectorClipJobs[e]},_processFormat:function(e){return e||n.DataFormat.GEOJSON},_processParams:function(e){return e?(e.query&&(e.query=e.query.toString()),e.bounds&&(e.bounds=e.bounds.toString()),e):{}}}),e.exports=n.REST.ProcessingService},function(e,t,r){"use strict";var n=r(2),i=r(0),s=r(5);r(13),r(14),i.AddressMatchService=i.Class(n,{initialize:function(e,t){n.prototype.initialize.apply(this,arguments)},destroy:function(){n.prototype.destroy.apply(this,arguments)},code:function(e,t){this.processAsync(e,t)},decode:function(e,t){this.processAsync(e,t)},processAsync:function(e,t){var r=this;return s.get(e,t).then(function(e){return e.json()}).then(function(e){e?r.serviceProcessCompleted(e):r.serviceProcessFailed(e)}).catch(function(e){r.eventListeners.processFailed({error:e})})},serviceProcessCompleted:function(e){n.prototype.serviceProcessCompleted.apply(this,arguments)},serviceProcessFailed:function(e){n.prototype.serviceProcessFailed.apply(this,arguments)},CLASS_NAME:"SuperMap.AddressMatchService"}),e.exports=i.AddressMatchService},function(e,t,r){"use strict";var n=r(0);n.BuildCacheJobParameter=n.Class({datasetName:"",cacheName:"",cacheType:"",serverAdresses:"",database:"",version:"",bounds:"",imageType:"Heatmap",level:null,initialize:function(e){e&&n.Util.extend(this,e)},destroy:function(){this.datasetName=null,this.cacheName=null,this.cacheType=null,this.serverAdresses=null,this.database=null,this.version=null,this.bounds=null,this.imageType=null,this.level=null}}),n.BuildCacheJobParameter.toObject=function(e,t){for(var r in e)"datasetName"!==r?n.Util.indexOf(["cacheName","cacheType","serverAdresses","database","version"],r)>-1?(t.output=t.output||{},t.output[r]=e[r]):(t.drawing=t.drawing||{},t.drawing[r]=e[r]):(t.input=t.input||{},t.input[r]=e[r])},e.exports=n.BuildCacheJobParameter},function(e,t,r){"use strict";var n=r(0),i=r(1),s=r(11);n.BuildCacheJobsService=n.Class(i,{initialize:function(e,t){i.prototype.initialize.apply(this,arguments),this.url+="/mapping/buildCache"},destroy:function(){i.prototype.destroy.apply(this,arguments)},getBuildCacheJobs:function(){return i.prototype.getJobs.apply(this,[this.url])},getBuildCacheJob:function(e){return i.prototype.getJobs.apply(this,[this.url+"/"+e])},addBuildCacheJob:function(e,t){i.prototype.addJob.apply(this,[this.url,e,s,t])},CLASS_NAME:"SuperMap.BuildCacheJobsService"}),e.exports=n.BuildCacheJobsService},function(e,t,r){"use strict";var n=r(0);n.GeoCodingParameter=n.Class({address:null,fromIndex:null,toIndex:null,filters:null,prjCoordSys:null,maxReturn:null,initialize:function(e){if(e){if(e.filters){var t=[];e.filters.split(",").map(function(e){t.push('"'+e+'"')}),e.filters=t}n.Util.extend(this,e)}},destroy:function(){this.address=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null}}),e.exports=n.GeoCodingParameter},function(e,t,r){"use strict";var n=r(0);n.GeoDecodingParameter=n.Class({x:null,y:null,fromIndex:null,toIndex:null,filters:null,prjCoordSys:null,maxReturn:null,geoDecodingRadius:null,initialize:function(e){if(e){if(e.filters){var t=[];e.filters.split(",").map(function(e){t.push('"'+e+'"')}),e.filters=t}n.Util.extend(this,e)}},destroy:function(){this.x=null,this.y=null,this.fromIndex=null,this.toIndex=null,this.filters=null,this.prjCoordSys=null,this.maxReturn=null,this.geoDecodingRadius=null}}),e.exports=n.GeoDecodingParameter},function(e,t,r){"use strict";var n=r(0);n.KernelDensityJobParameter=n.Class({datasetName:"",query:"",resolution:80,method:0,meshType:0,fields:"",radius:300,meshSizeUnit:"Meter",radiusUnit:"Meter",areaUnit:"SquareMile",initialize:function(e){e&&n.Util.extend(this,e)},destroy:function(){this.datasetName=null,this.query=null,this.resolution=null,this.method=null,this.radius=null,this.meshType=null,this.fields=null,this.meshSizeUnit=null,this.radiusUnit=null,this.areaUnit=null}}),n.KernelDensityJobParameter.toObject=function(e,t){for(var r in e)"datasetName"!==r?(t.analyst=t.analyst||{},t.analyst[r]=e[r]):(t.input=t.input||{},t.input[r]=e[r])},e.exports=n.KernelDensityJobParameter},function(e,t,r){"use strict";var n=r(0),i=r(1),s=r(15);n.KernelDensityJobsService=n.Class(i,{initialize:function(e,t){i.prototype.initialize.apply(this,arguments),this.url+="/spatialanalyst/density"},destroy:function(){i.prototype.destroy.apply(this,arguments)},getKernelDensityJobs:function(){return i.prototype.getJobs.apply(this,[this.url])},getKernelDensityJob:function(e){return i.prototype.getJobs.apply(this,[this.url+"/"+e])},addKernelDensityJob:function(e,t){return i.prototype.addJob.apply(this,[this.url,e,s,t])},CLASS_NAME:"SuperMap.KernelDensityJobsService"}),e.exports=n.KernelDensityJobsService},function(e,t,r){"use strict";var n=r(0);n.SingleObjectQueryJobsParameter=n.Class({datasetName:"",datasetQuery:"",mode:"CONTAIN",initialize:function(e){e&&n.Util.extend(this,e)},destroy:function(){this.datasetName=null,this.datasetQuery=null,this.mode=null}}),n.SingleObjectQueryJobsParameter.toObject=function(e,t){for(var r in e)"datasetName"!==r?(t.analyst=t.analyst||{},t.analyst[r]=e[r]):(t.input=t.input||{},t.input[r]=e[r])},e.exports=n.SingleObjectQueryJobsParameter},function(e,t,r){"use strict";var n=r(0),i=r(1),s=r(17);n.SingleObjectQueryJobsService=n.Class(i,{initialize:function(e,t){i.prototype.initialize.apply(this,arguments),this.url+="/spatialanalyst/query"},destroy:function(){i.prototype.destroy.apply(this,arguments)},getQueryJobs:function(){return i.prototype.getJobs.apply(this,[this.url])},getQueryJob:function(e){return i.prototype.getJobs.apply(this,[this.url+"/"+e])},addQueryJob:function(e,t){return i.prototype.addJob.apply(this,[this.url,e,s,t])},CLASS_NAME:"SuperMap.SingleObjectQueryJobsService"}),e.exports=n.SingleObjectQueryJobsService},function(e,t,r){"use strict";var n=r(0);n.SummaryMeshJobParameter=n.Class({datasetName:"",regionDataset:"",query:"",resolution:100,meshType:0,statisticModes:"",fields:"",type:"SUMMARYMESH",initialize:function(e){e&&n.Util.extend(this,e)},destroy:function(){this.datasetName=null,this.query=null,this.resolution=null,this.statisticModes=null,this.meshType=null,this.fields=null,this.regionDataset=null,this.type=null}}),n.SummaryMeshJobParameter.toObject=function(e,t){for(var r in e)"datasetName"!==r?"type"!==r?("SUMMARYMESH"===e.type&&"regionDataset"!==r||"SUMMARYREGION"===e.type&&!function(e,t){for(var r=e.length;r--;)if(e[r]===t)return!0;return!1}(["meshType","resolution","query"],r))&&(t.analyst=t.analyst||{},t.analyst[r]=e[r]):t.type=e[r]:(t.input=t.input||{},t.input[r]=e[r])},e.exports=n.SummaryMeshJobParameter},function(e,t,r){"use strict";var n=r(0),i=r(1),s=r(19);n.SummaryMeshJobsService=n.Class(i,{initialize:function(e,t){i.prototype.initialize.apply(this,arguments),this.url+="/spatialanalyst/aggregatepoints"},destroy:function(){i.prototype.destroy.apply(this,arguments)},getSummaryMeshJobs:function(){return i.prototype.getJobs.apply(this,[this.url])},getSummaryMeshJob:function(e){return i.prototype.getJobs.apply(this,[this.url+"/"+e])},addSummaryMeshJob:function(e,t){i.prototype.addJob.apply(this,[this.url,e,s,t])},CLASS_NAME:"SuperMap.SummaryMeshJobsService"}),e.exports=n.SummaryMeshJobsService},function(e,t,r){"use strict";var n=r(0);n.SummaryRegionJobParameter=n.Class({datasetName:"",regionDataset:"",sumShape:!0,query:"",standardSummaryFields:!1,standardFields:"",standardStatisticModes:"",weightedSummaryFields:!1,weightedFields:"",weightedStatisticModes:"",meshType:0,resolution:100,meshSizeUnit:"Meter",type:"SUMMARYMESH",initialize:function(e){e&&n.Util.extend(this,e)},destroy:function(){this.datasetName=null,this.sumShape=null,this.query=null,this.standardSummaryFields=null,this.standardFields=null,this.standardStatisticModes=null,this.weightedSummaryFields=null,this.weightedFields=null,this.weightedStatisticModes=null,this.meshType=null,this.resolution=null,this.meshSizeUnit=null,this.type=null}}),n.SummaryRegionJobParameter.toObject=function(e,t){for(var r in e)"datasetName"!==r?"type"!==r?("SUMMARYREGION"===e.type||"SUMMARYMESH"===e.type&&"regionDataset"!==r)&&(t.analyst=t.analyst||{},t.analyst[r]=e[r]):t.type=e[r]:(t.input=t.input||{},t.input[r]=e[r])},e.exports=n.SummaryRegionJobParameter},function(e,t,r){"use strict";var n=r(0),i=r(1),s=r(21);n.SummaryRegionJobsService=n.Class(i,{initialize:function(e,t){i.prototype.initialize.apply(this,arguments),this.url+="/spatialanalyst/summaryregion"},destroy:function(){i.prototype.destroy.apply(this,arguments)},getSummaryRegionJobs:function(){return i.prototype.getJobs.apply(this,[this.url])},getSummaryRegionJob:function(e){return i.prototype.getJobs.apply(this,[this.url+"/"+e])},addSummaryRegionJob:function(e,t){return i.prototype.addJob.apply(this,[this.url,e,s,t])},CLASS_NAME:"SuperMap.SummaryRegionJobsService"}),e.exports=n.SummaryRegionJobsService},function(e,t,r){"use strict";var n=r(0);n.VectorClipJobsParameter=n.Class({datasetName:"",datasetOverlay:"",mode:"clip",initialize:function(e){(e=e||{}).mode&&"string"==typeof e.mode&&(e.mode=e.mode.toLowerCase()),n.Util.extend(this,e)},destroy:function(){this.datasetName=null,this.datasetOverlay=null,this.mode=null}}),n.VectorClipJobsParameter.toObject=function(e,t){for(var r in e)"datasetName"!==r?(t.analyst=t.analyst||{},t.analyst[r]=e[r]):(t.input=t.input||{},t.input[r]=e[r])},e.exports=n.VectorClipJobsParameter},function(e,t,r){"use strict";var n=r(0),i=r(1),s=r(23);n.VectorClipJobsService=n.Class(i,{initialize:function(e,t){i.prototype.initialize.apply(this,arguments),this.url+="/spatialanalyst/vectorclip"},destroy:function(){i.prototype.destroy.apply(this,arguments)},getVectorClipJobs:function(){return i.prototype.getJobs.apply(this,[this.url])},getVectorClipJob:function(e){return i.prototype.getJobs.apply(this,[this.url+"/"+e])},addVectorClipJob:function(e,t){return i.prototype.addJob.apply(this,[this.url,e,s,t])},CLASS_NAME:"SuperMap.VectorClipJobsService"}),e.exports=n.VectorClipJobsService},function(e,t,r){"use strict";r(4);var n=r(0);n.KeyServiceParameter=n.Class({name:null,serviceIds:null,clientType:n.ClientType.SERVER,limitation:null,initialize:function(e){n.Util.extend(this,e)},toJSON:function(){return{name:this.name,serviceIds:this.serviceIds,clientType:this.clientType,limitation:this.limitation}},CLASS_NAME:"SuperMap.KeyServiceParameter"}),e.exports=n.KeyServiceParameter},function(e,t,r){"use strict";r(27),r(28),r(25);var n=r(5),i=r(0);i.SecurityManager={INNER_WINDOW_WIDTH:600,INNER_WINDOW_HEIGHT:600,generateToken:function(e,t){var r=this.servers[e];if(r)return n.post(r.tokenServiceUrl,JSON.stringify(t.toJSON())).then(function(e){return e.text()})},registerServers:function(e){this.servers=this.servers||{},i.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++){var r=e[t];this.servers[r.server]=r}},registerToken:function(e,t){if(this.tokens=this.tokens||{},e&&t){var r=this._getTokenStorageKey(e);this.tokens[r]=t}},registerKey:function(e,t){if(this.keys=this.keys||{},e&&!(e.length<1)&&t){e=i.Util.isArray(e)?e:[e];for(var r=0;r<e.length;r++){var n=this._getUrlRestString(e[0])||e[0];this.keys[n]=t}}},getServerInfo:function(e){return this.servers=this.servers||{},this.servers[e]},getToken:function(e){if(e){this.tokens=this.tokens||{};var t=this._getTokenStorageKey(e);return this.tokens[t]}},getKey:function(e){this.keys=this.keys||{};var t=this._getUrlRestString(e)||e;return this.keys[t]},loginOnline:function(e,t){var r=i.SecurityManager.SSO+"/login?service="+e;this._open(r,t)},loginPortal:function(e,t){e+="/"===e.substr(e.length-1,1)?"web/login":"/web/login",this._open(e,t)},destroyAllCredentials:function(){this.keys=null,this.tokens=null,this.servers=null},destroyToken:function(e){if(e){var t=this._getTokenStorageKey(e);this.tokens=this.tokens||{},this.tokens[t]&&delete this.tokens[t]}},destroyKey:function(e){if(e){this.keys=this.keys||{};var t=this._getUrlRestString(e)||e;this.keys[t]&&delete this.keys[t]}},_open:function(e,t){t=null==t||t;var r=window.screen.availWidth/2-this.INNER_WINDOW_WIDTH/2,n=window.screen.availHeight/2-this.INNER_WINDOW_HEIGHT/2,i="height="+this.INNER_WINDOW_HEIGHT+", width="+this.INNER_WINDOW_WIDTH+",top="+n+", left="+r+",toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no";t?window.open(e,"login"):window.open(e,"login",i)},_getTokenStorageKey:function(e){var t=/http:\/\/([^\/]+)/i,r=e.match(t);return r?r[0]:e},_getUrlRestString:function(e){if(!e)return e;var t=/http:\/\/(.*\/rest)/i,r=e.match(t);return r?r[0]:e}},i.SecurityManager.SSO="https://sso.supermap.com",i.SecurityManager.ONLINE="http://www.supermapol.com",e.exports=i.SecurityManager},function(e,t,r){"use strict";r(4);var n=r(0);n.ServerInfo=n.Class({type:null,server:null,tokenServiceUrl:null,keyServiceUrl:null,initialize:function(e,t){this.type=e||n.ServerType.ISERVER,n.Util.extend(this,t),this.server||console.error("server url require is not  undefined");var r=/http:\/\/([^\/]+)/i;this.server=this.server.match(r)[0];var i="/services/security/tokens.json";this.type===n.ServerType.ISERVER&&this.server.indexOf("iserver")<0&&(i="/iserver"+i),this.tokenServiceUrl||(this.tokenServiceUrl=this.server+i),this.keyServiceUrl||(this.type===n.ServerType.IPORTAL?this.keyServiceUrl=this.server+"/web/mycontent/keys/register.json":this.type===n.ServerType.ONLINE&&(this.keyServiceUrl=this.server+"/web/mycontent/keys.json"))},CLASS_NAME:"SuperMap.ServerInfo"}),e.exports=n.ServerInfo},function(e,t,r){"use strict";r(4);var n=r(0);n.TokenServiceParameter=n.Class({userName:null,password:null,clientType:n.ClientType.NONE,ip:null,referer:null,expiration:60,initialize:function(e){n.Util.extend(this,e)},toJSON:function(){return{userName:this.userName,password:this.password,clientType:this.clientType,ip:this.ip,referer:this.referer,expiration:this.expiration}},CLASS_NAME:"SuperMap.TokenServiceParameter"}),e.exports=n.TokenServiceParameter},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},u=r(3),l={};try{l=r(32)}catch(e){l={}}var c=l.baiduMapLayer?l.baiduMapLayer.__proto__:Function,p=function(e){function t(e,r,s,o){if(n(this,t),!c)return i(a);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,s,o)),u=a;return o=o||{},u.init(o),u.argCheck(o),a.canvasLayer=r,u.transferToMercator(),a.clickEvent=a.clickEvent.bind(a),a.mousemoveEvent=a.mousemoveEvent.bind(a),a.bindEvent(),a}return s(t,c),o(t,[{key:"clickEvent",value:function(e){var r=e.layerPoint;a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clickEvent",this).call(this,r,e)}},{key:"mousemoveEvent",value:function(e){var r=e.layerPoint;a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"mousemoveEvent",this).call(this,r,e)}},{key:"bindEvent",value:function(e){var t=this.map;this.options.methods&&(this.options.methods.click&&t.events.on({click:this.clickEvent}),this.options.methods.mousemove&&t.events.on({mousemove:this.mousemoveEvent}))}},{key:"unbindEvent",value:function(e){var t=this.map;this.options.methods&&(this.options.methods.click&&t.events.un({click:this.clickEvent}),this.options.methods.mousemove&&t.events.un({mousemove:this.mousemoveEvent}))}},{key:"getContext",value:function(){return this.canvasLayer&&this.canvasLayer.canvasContext}},{key:"addData",value:function(e,t){var r=e;e&&e.get&&(r=e.get()),this.dataSet.add(r),this.update({options:t})}},{key:"setData",value:function(e,t){var r=e;e&&e.get&&(r=e.get()),this.dataSet=this.dataSet||new l.DataSet,this.dataSet.set(r),this.update({options:t})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(e){if(this.dataSet){var t=this.dataSet.get(e);this.dataSet.set(t),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"render",value:function(e){this._canvasUpdate(e)}},{key:"transferToMercator",value:function(){if(this.options.coordType&&["bd09mc","coordinates_mercator"].indexOf(this.options.coordType)>-1){var e=this.dataSet.get();e=this.dataSet.transferCoordinate(e,function(e){var t=u.Projection.transform({x:e[0],y:e[1]},"EPSG:3857","EPSG:4326");return[t.x,t.y]},"coordinates","coordinates"),this.dataSet._set(e)}}},{key:"_canvasUpdate",value:function(e){if(this.canvasLayer){var t=this,r=t.options.animation,n=this.getContext(),i=this.map;if(t.isEnabledTime()){if(void 0===e)return void this.clear(n);"2d"===this.context&&(n.save(),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, .1)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore())}else this.clear(n);if("2d"===this.context)for(var s in t.options)n[s]=t.options[s];else n.clear(n.COLOR_BUFFER_BIT);if(!(t.options.minZoom&&i.getZoom()<t.options.minZoom||t.options.maxZoom&&i.getZoom()>t.options.maxZoom)){var o=t.canvasLayer,a={fromColumn:"coordinates",transferCoordinate:function(e){var t=o.transferToMapLatLng({lon:e[0],lat:e[1]}),r=i.getViewPortPxFromLonLat(t);return[r.x,r.y]}};void 0!==e&&(a.filter=function(t){var n=r.trails||10;return e&&t.time>e-n&&t.time<e});var u=t.dataSet.get(a);this.processData(u),t.options._size=t.options.size;var c=i.getViewPortPxFromLonLat(o.transferToMapLatLng({lon:0,lat:0})),p=Math.pow(2,14-i.getZoom());"m"==t.options.unit?(t.options.size&&(t.options._size=t.options.size/p),t.options.width&&(t.options._width=t.options.width/p),t.options.height&&(t.options._height=t.options.height/p)):(t.options._size=t.options.size,t.options._height=t.options.height,t.options._width=t.options.width),this.drawContext(n,new l.DataSet(u),t.options,c),t.options.updateCallback&&t.options.updateCallback(e)}}}},{key:"init",value:function(e){var t=this;t.options=e,this.initDataRange(e),this.context=t.options.context||"2d",t.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(t.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.events.on({movestart:this.animatorMovestartEvent.bind(this)}),this.map.events.on({moveend:this.animatorMoveendEvent.bind(this)})}},{key:"clear",value:function(e){e&&e.clearRect&&e.clearRect(0,0,e.canvas.width,e.canvas.height)}},{key:"show",value:function(){this.map.addLayer(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeLayer(this.canvasLayer)}},{key:"draw",value:function(){this.canvasLayer.redraw()}}]),t}();e.exports=p},function(e,t,r){var n,i,s;!function(r,o){i=[t,e],void 0!==(s="function"==typeof(n=o)?n.apply(t,i):n)&&(e.exports=s)}(0,function(e,t){"use strict";function r(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function n(e){try{delete window[e]}catch(t){window[e]=void 0}}function i(e){var t=document.getElementById(e);document.getElementsByTagName("head")[0].removeChild(t)}var s={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};t.exports=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=e,a=t.timeout||s.timeout,u=t.jsonpCallback||s.jsonpCallback,l=void 0;return new Promise(function(s,c){var p=t.jsonpCallbackFunction||r(),h=u+"_"+p;window[p]=function(e){s({ok:!0,json:function(){return Promise.resolve(e)}}),l&&clearTimeout(l),i(h),n(p)},o+=-1===o.indexOf("?")?"?":"&";var d=document.createElement("script");d.setAttribute("src",""+o+u+"="+p),d.id=h,document.getElementsByTagName("head")[0].appendChild(d),l=setTimeout(function(){c(new Error("JSONP request to "+e+" timed out")),n(p),i(h)},a)})}})},function(e,t){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=String(e)),e}function n(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return m.iterable&&(t[Symbol.iterator]=function(){return t}),t}function i(e){this.map={},e instanceof i?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function s(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function o(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function a(e){var t=new FileReader,r=o(t);return t.readAsArrayBuffer(e),r}function u(e){var t=new FileReader,r=o(t);return t.readAsText(e),r}function l(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}function c(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(m.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(m.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(m.arrayBuffer&&m.blob&&v(e))this._bodyArrayBuffer=c(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!m.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!S(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=c(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m.blob&&(this.blob=function(){var e=s(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?s(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=s(this);if(e)return e;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(l(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},m.formData&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}function h(e){var t=e.toUpperCase();return I.indexOf(t)>-1?t:e}function d(e,t){var r=(t=t||{}).body;if(e instanceof d){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new i(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new i(t.headers)),this.method=h(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function y(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function f(e){var t=new i;return e.split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}}),t}function E(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new i(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var m={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(m.arrayBuffer)var T=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],v=function(e){return e&&DataView.prototype.isPrototypeOf(e)},S=ArrayBuffer.isView||function(e){return e&&T.indexOf(Object.prototype.toString.call(e))>-1};i.prototype.append=function(e,n){e=t(e),n=r(n);var i=this.map[e];this.map[e]=i?i+","+n:n},i.prototype.delete=function(e){delete this.map[t(e)]},i.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},i.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},i.prototype.set=function(e,n){this.map[t(e)]=r(n)},i.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},i.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),n(e)},i.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),n(e)},i.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),n(e)},m.iterable&&(i.prototype[Symbol.iterator]=i.prototype.entries);var I=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this,{body:this._bodyInit})},p.call(d.prototype),p.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new i(this.headers),url:this.url})},E.error=function(){var e=new E(null,{status:0,statusText:""});return e.type="error",e};var N=[301,302,303,307,308];E.redirect=function(e,t){if(-1===N.indexOf(t))throw new RangeError("Invalid status code");return new E(null,{status:t,headers:{location:e}})},e.Headers=i,e.Request=d,e.Response=E,e.fetch=function(e,t){return new Promise(function(r,n){var i=new d(e,t),s=new XMLHttpRequest;s.onload=function(){var e={status:s.status,statusText:s.statusText,headers:f(s.getAllResponseHeaders()||"")};e.url="responseURL"in s?s.responseURL:e.headers.get("X-Request-URL");var t="response"in s?s.response:s.responseText;r(new E(t,e))},s.onerror=function(){n(new TypeError("Network request failed"))},s.ontimeout=function(){n(new TypeError("Network request failed"))},s.open(i.method,i.url,!0),"include"===i.credentials&&(s.withCredentials=!0),"responseType"in s&&m.blob&&(s.responseType="blob"),i.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},function(e,t){if("undefined"==typeof mapv){var r=new Error('Cannot find module "mapv"');throw r.code="MODULE_NOT_FOUND",r}e.exports=mapv},function(e,t,r){r(9),r(8),e.exports=r(7)}]);